<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="generator" content="pandoc">
    <meta name="description" content="">

    <title>Microservices_Tutorial</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="https://maxcdn.bootstrapcdn.com/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="https://mushiyo.github.io/pandoc-toc-sidebar/css/dashboard.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">code{white-space: pre;}</style>
    <style type="text/css">.sidebar ul{padding-left: 10px;} .sidebar{background-color: #dadada;}</style>
    <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    </style>
  </head>

  <body>

    <div class="container-fluid">
      <div class="row">
        <div id="sidebar" class="col-sm-3 col-md-2 sidebar">
          <!--<ul class="nav nav-sidebar">
            <li class="active"><a href="#">Overview <span class="sr-only">(current)</span></a></li>
          </ul>-->
          <ul>
          <li><a href="#microservices-tutorial"
          id="toc-microservices-tutorial">Microservices
          Tutorial</a></li>
          <li><a href="#web-service" id="toc-web-service">Web
          Service</a></li>
          <li><a href="#building-rest-api"
          id="toc-building-rest-api">Building REST API</a>
          <ul>
          <li><a href="#advanced-rest-api-features"
          id="toc-advanced-rest-api-features">Advanced Rest API
          Features</a></li>
          </ul></li>
          <li><a href="#microservicesv1"
          id="toc-microservicesv1">Microservices(V1)</a></li>
          <li><a href="#microservicesv3"
          id="toc-microservicesv3"><strong>Microservices(V3)</strong></a>
          <ul>
          <li><a href="#standardized-ports"
          id="toc-standardized-ports">Standardized Ports</a></li>
          <li><a href="#standardized-urls"
          id="toc-standardized-urls">Standardized URLs</a></li>
          <li><a href="#hosted-urls" id="toc-hosted-urls">Hosted
          URLs</a></li>
          <li><a href="#currency-config-repository"
          id="toc-currency-config-repository">Currency Config
          Repository</a></li>
          <li><a href="#config-server-microservice"
          id="toc-config-server-microservice">Config Server
          Microservice</a></li>
          <li><a href="#limits-microservice"
          id="toc-limits-microservice">Limits Microservice</a></li>
          <li><a href="#currency-exchange"
          id="toc-currency-exchange">Currency Exchange</a></li>
          <li><a href="#currency-conversion"
          id="toc-currency-conversion">Currency Conversion</a>
          <ul>
          <li><a href="#feign-client-integration"
          id="toc-feign-client-integration">Feign Client
          Integration</a></li>
          </ul></li>
          <li><a href="#eureka-naming-server"
          id="toc-eureka-naming-server"><strong>Eureka Naming
          Server</strong></a></li>
          <li><a href="#load-balancing-with-eureka"
          id="toc-load-balancing-with-eureka"><strong>Load Balancing
          with Eureka</strong></a></li>
          <li><a href="#spring-cloud-api-gateway"
          id="toc-spring-cloud-api-gateway"><strong>Spring Cloud API
          Gateway</strong></a>
          <ul>
          <li><a
          href="#auto-routing-with-cloud-gateway-discovery-locator"
          id="toc-auto-routing-with-cloud-gateway-discovery-locator">Auto
          Routing with Cloud Gateway Discovery Locator</a></li>
          <li><a
          href="#custom-routing-and-custom-filter-for-specific-api"
          id="toc-custom-routing-and-custom-filter-for-specific-api">Custom
          Routing and Custom Filter for specific API</a></li>
          <li><a href="#gateway-global-filters"
          id="toc-gateway-global-filters">Gateway Global
          Filters</a></li>
          </ul></li>
          <li><a href="#circuit-breaker--resilience4j"
          id="toc-circuit-breaker--resilience4j"><strong>Circuit
          Breaker- Resilience4j</strong></a></li>
          <li><a href="#observability-and-opentelemetry"
          id="toc-observability-and-opentelemetry"><strong>Observability
          and OpenTelemetry</strong></a></li>
          <li><a href="#zipkin---distributed-tracing"
          id="toc-zipkin---distributed-tracing"><strong>Zipkin -
          Distributed Tracing</strong></a>
          <ul>
          <li><a href="#connecting-zipkin-with-other-microservices"
          id="toc-connecting-zipkin-with-other-microservices">Connecting
          Zipkin with other Microservices</a></li>
          </ul></li>
          <li><a href="#docker---container-orchestration"
          id="toc-docker---container-orchestration">Docker - Container
          Orchestration</a>
          <ul>
          <li><a href="#create-docker-image"
          id="toc-create-docker-image">Create Docker Image</a></li>
          <li><a href="#docker-compose" id="toc-docker-compose">Docker
          Compose</a></li>
          </ul></li>
          <li><a href="#kubernetes"
          id="toc-kubernetes">Kubernetes</a></li>
          </ul></li>
          <li><a href="#todo" id="toc-todo">#TODO</a></li>
          </ul>
        </div>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
        
<h1 id="microservices-tutorial">Microservices Tutorial</h1>
<p><strong>Tech Stack :</strong></p>
<p><img src="https://pbs.twimg.com/profile_images/1235868806079057921/fTL08u_H_400x400.png" alt="Spring Boot (@springboot) / X" style="zoom: 33%;" />
<img src="https://static.javatpoint.com/tutorial/spring-cloud/images/spring-cloud.png" alt="Spring Cloud Tutorial - Javatpoint" style="zoom: 50%;" />
<img src="https://miro.medium.com/v2/resize:fit:486/1*mwUghPGDjdVNOe8y7Pkrpg.png" alt="Implementing Service Discovery Using Netflix Eureka | by Seonggil Jeong |  Medium" style="zoom: 33%;" />
<img src="https://content.cdntwrk.com/files/aHViPTYzOTc1JmNtZD1pdGVtZWRpdG9yaW1hZ2UmZmlsZW5hbWU9aXRlbWVkaXRvcmltYWdlXzY0MjYxYmY1NzQ0ODEucG5nJnZlcnNpb249MDAwMCZzaWc9NDBhNTg4NmQ3ZGFjMzliZmY2ZDQ3Y2JhMjU5MTlhNTA%253D" alt="Announcing Spring Cloud Gateway for Kubernetes 2.0" style="zoom: 40%;" />
<img src="https://avatars.githubusercontent.com/u/11860887?v=4" alt="GitHub - openzipkin/zipkin: Zipkin is a distributed tracing system" style="zoom:25%;" />
<img src="https://i.postimg.cc/Px3XB3VL/res.png" alt="Knoldus Blogs Java - Introduction To Resilience4j" style="zoom: 50%;" />
<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS5hPnQgYIb2fp0KenorFRSOXY268hay_nISrnJtv-6ng&s" alt="Docker full logo transparent PNG - StickPNG" style="zoom: 70%;" />
<img src="https://sue.eu/wp-content/uploads/sites/6/2022/06/kubernetes-logo-920x920-sue-v0.png" alt="Kubernetes | SUE Cloud & IT Professionals" style="zoom: 16%;" />
<img src="https://avatars.githubusercontent.com/u/20077752?s=64&v=4" alt="OpenFeign · GitHub" style="zoom: 25%;" />
<img src="https://howtodoinjava.com/wp-content/uploads/2019/12/spring-hateoas.png" alt="Spring Boot HATEOAS Links Example" style="zoom: 25%;" />
<img src="https://miro.medium.com/v2/resize:fit:720/1*FNJ6C1uNvCAhkJR3i7pvoQ.jpeg" alt="Hystrix + Spring Boot Implementation | by Vinesh | The Jabberjays | Medium" style="zoom: 35%;" />
<img src="https://camo.githubusercontent.com/c9c03fc8fd1261971c38aafd0b95f59eee0af2b435277586949579dfe8b5198d/68747470733a2f2f692e696d6775722e636f6d2f6d52536f7345702e706e67" alt="GitHub - Netflix/zuul: Zuul is a gateway service that provides dynamic  routing, monitoring, resiliency, security, and more." style="zoom: 12%;" /></p>
<p><a
href="https://www.udemy.com/course/microservices-with-spring-boot-and-spring-cloud/?couponCode=UPGRADE02223">Udemy
Course Link</a></p>
<p><img src="images/roadmap1.png" alt="" style="zoom: 67%;" /></p>
<p><img src="images/roadmap2.png" alt="" style="zoom: 67%;" /></p>
<h1 id="web-service">Web Service</h1>
<blockquote>
<p><strong>Definition : </strong> Software system designed to support
interoperable machine-to-machine interaction over a network.</p>
</blockquote>
<ul>
<li><p><strong>3 Keys of Web Service</strong></p>
<ul>
<li><p>Designed for machine-to-machine (or application-to-application)
interaction</p></li>
<li><p>Should be interoperable - Not platform dependent. As it shouldn’t
matter which language our web service made i.e. Java, PHP, .Net
etc.</p></li>
<li><p>Should allow communication over a network</p></li>
</ul></li>
<li><p>How does data exchange between applications take place?</p>
<ul>
<li>By Request and Response</li>
</ul></li>
<li><p>How can we make web services platform independent?</p>
<ul>
<li>There are 2 popular formats widely accepted by most of frontend and
backend languages - <strong>XML</strong> and <strong>JSON</strong></li>
</ul></li>
</ul>
<p><strong>Transport</strong> - It defines how a service is called.</p>
<ul>
<li><p><strong>HTTP</strong> - It is the service exposed over the
internet.</p></li>
<li><p><strong>MQ</strong> - Message Queue (e.g. WebSphere MQ) is the
service exposed over a queue. <em>Here Service requestor place a message
in queue, Service Provider listening on the queue and as soon as there
is a request on the queue, it would take the request, do the processing
of it, create the response and put it back into the queue.</em></p>
<p><img src="images/transport.png" alt="transport" style="zoom: 80%;" /></p></li>
</ul>
<p><strong>Web Service Groups</strong> : There are 2 types of web
services -</p>
<ol type="1">
<li><p><em>SOAP (Simple Object Access Protocol)</em></p></li>
<li><p><em>REST (Representational State Transfer)</em></p></li>
<li><p><strong><em>SOAP (Simple Object Access
Protocol)</em></strong></p>
<ul>
<li>Format - SOAP XML Request - SOAP XML Response</li>
<li>Transport : MQ or HTTP , There is no restriction.</li>
<li>Service Definition : WSDL (Web Services Description Language)</li>
</ul>
<p><img src="images/soap.png" alt="transport" style="zoom: 50%;" /></p>
<p>SOAP Example Request / Response :</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode xml"><code class="sourceCode xml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">SOAP-ENV:Envelope</span><span class="ot"> xmlns:SOAPENV=</span><span class="st">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span>&gt;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">SOAP-ENV:Header</span>/&gt;</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">SOAP-ENV:Body</span>&gt;</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">ns2:getCourseDetailsResponse</span><span class="ot"> xmlns:ns2=</span><span class="st">&quot;http://in28minutes.com/courses&quot;</span>&gt;</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">ns2:course</span>&gt;</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">ns2:id</span>&gt;Course1&lt;/<span class="kw">ns2:id</span>&gt;</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">ns2:name</span>&gt;Spring&lt;/<span class="kw">ns2:name</span>&gt;</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">ns2:description</span>&gt;10 Steps&lt;/<span class="kw">ns2:description</span>&gt;</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>            &lt;/<span class="kw">ns2:course</span>&gt;</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">ns2:getCourseDetailsResponse</span>&gt;</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">SOAP-ENV:Body</span>&gt;</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">SOAP-ENV:Envelope</span>&gt;</span></code></pre></div></li>
<li><p><strong><em>REST (Representational State
Transfer)</em></strong></p>
<ul>
<li>Data Exchange Format - No Restriction. JSON is popular</li>
<li>Transport : Only HTTP</li>
<li>Service Definition : No Standard. WADL/Swagger/…</li>
</ul></li>
</ol>
<ul>
<li><strong>HOW to build a great REST API?</strong>
<ul>
<li>Identifying Resources (/users, /users/{id}/posts)</li>
<li>Identifying Actions (GET, POST, PUT, DELETE, …)</li>
<li>Defining Request and Response structures</li>
<li>Using appropriate Response Status (200, 404, 500, ..)</li>
<li>Understanding REST API Best Practices
<ul>
<li>Thinking from the perspective of your consumer</li>
<li><strong>Validation, Internationalization - i18n, Exception Handling,
HATEOAS, Versioning,</strong> <strong>Documentation, Content
Negotiation</strong> and a lot more!</li>
</ul></li>
</ul></li>
</ul>
<hr />
<h1 id="building-rest-api">Building REST API</h1>
<p><strong>What’s Happening in the Background?</strong></p>
<p>Let’s explore some Spring Boot Magic: Enable Debug Logging. WARNING:
Log change frequently!</p>
<ol type="1">
<li><p>How are our requests handled?</p>
<ul>
<li>DispatcherServlet - Front Controller Pattern
<ul>
<li>Mapping servlets: dispatcherServlet urls=[/]</li>
<li>Auto Configuration (DispatcherServletAutoConfiguration)</li>
</ul></li>
</ul></li>
<li><p>How does HelloWorldBean object get converted to JSON?</p>
<ul>
<li><span class="citation"
data-cites="ResponseBody">@ResponseBody</span> +
JacksonHttpMessageConverters</li>
<li>Auto Configuration (JacksonHttpMessageConvertersConfiguration)</li>
</ul></li>
<li><p>Who is configuring error mapping?</p>
<ul>
<li>Auto Configuration (ErrorMvcAutoConfiguration)</li>
</ul></li>
<li><p>How are all jars available(Spring, Spring MVC, Jackson,
Tomcat)?</p>
<ul>
<li>Starter Projects - Spring Boot Starter Web (spring-webmvc,
spring-web, springboot-starter-tomcat, spring-boot-starter-json)</li>
</ul></li>
</ol>
<h3 id="advanced-rest-api-features">Advanced Rest API Features</h3>
<ul>
<li>Documentation - Swagger</li>
<li>Content Negotiation (What if consumer expect a XML response back ?
)</li>
<li>Internationalization - i18n (How to customize API response according
to language of user throughout the world ? )</li>
<li>Versioning</li>
<li>HATEOAS</li>
<li>Static Filtering</li>
<li>Dynamic Filtering</li>
<li>Monitoring</li>
</ul>
<h4 id="documentation"><strong>Documentation</strong></h4>
<p>We need to use springdoc-openapi version 2+ for Spring Boot 3 and
JDK17.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode xml"><code class="sourceCode xml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">dependency</span>&gt;</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">groupId</span>&gt;org.springdoc&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">artifactId</span>&gt;springdoc-openapi-starter-webmvc-ui&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">version</span>&gt;2.0.0&lt;/<span class="kw">version</span>&gt;</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">dependency</span>&gt;</span></code></pre></div>
<h4 id="content-negotiation"><strong>Content Negotiation</strong></h4>
<ul>
<li><p>Same Resource - Same URI</p></li>
<li><p>HOWEVER Different Representations are possible</p>
<ul>
<li>Example: Different Content Type - XML or JSON (Accept header (MIME
types - application/xml, application/json, …)</li>
<li>Example: Different Language - English or Dutch or french
(Accept-Language header (en, nl, fr, ..))</li>
</ul></li>
</ul>
<p><strong>Steps of Content Negotiation</strong></p>
<ul>
<li><p>STEP 1: add this in <strong><em>pom.xml</em></strong></p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode xml"><code class="sourceCode xml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.dataformat/jackson-dataformat-xml --&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">dependency</span>&gt;</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">groupId</span>&gt;com.fasterxml.jackson.dataformat&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">artifactId</span>&gt;jackson-dataformat-xml&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">dependency</span>&gt;</span></code></pre></div></li>
<li><p>STEP 2: Add <code>Accept</code> header in postman for
<code>application/xml</code>. If we don’t provide this header, default
is <code>application/json</code></p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">--location</span> <span class="st">&#39;http://localhost:8080/users&#39;</span> <span class="dt">\</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>--header <span class="st">&#39;Accept: application/xml&#39;</span></span></code></pre></div></li>
</ul>
<h4 id="internationalization"><strong>Internationalization</strong></h4>
<p>Typically HTTP Request Header - <code>Accept-Language</code> is used.
<code>Accept-Language</code> - indicates natural language and locale
that the consumer prefers</p>
<ul>
<li>Example: en - English (Good Morning)</li>
<li>Example: nl - Dutch (Goedemorgen)</li>
<li>Example: fr - French (Bonjour)</li>
<li>Example: de - Deutsch (Guten Morgen)</li>
</ul>
<h4 id="versioning"><strong>Versioning</strong></h4>
<ol type="1">
<li><strong>URI Versioning - Twitter</strong>
<ul>
<li>http://localhost:8080/v1/person</li>
<li>http://localhost:8080/v2/person</li>
</ul></li>
<li><strong>Request Parameter versioning - Amazon</strong>
<ul>
<li>http://localhost:8080/person?version=1</li>
<li>http://localhost:8080/person?version=2</li>
</ul></li>
<li><strong>(Custom) headers versioning - Microsoft</strong></li>
</ol>
<ul>
<li>SAME-URL headers=[X-API-VERSION=1]</li>
<li>SAME-URL headers=[X-API-VERSION=2]</li>
</ul>
<ol start="4" type="1">
<li><strong>Media type versioning (a.k.a “content negotiation” or
“accept header”) - GitHub</strong></li>
</ol>
<ul>
<li><p>SAME-URL produces=application/vnd.company.app-v1+json</p></li>
<li><p>SAME-URL produces=application/vnd.company.app-v2+json</p></li>
<li><p>Factors to consider</p>
<ul>
<li>URI Pollution</li>
<li>Misuse of HTTP Headers</li>
<li>Caching</li>
<li>Can we execute the request on the browser?</li>
<li>API Documentation</li>
<li>Summary: No Perfect Solution</li>
</ul></li>
<li><p>Recommendations</p>
<ul>
<li>Think about versioning even before you need it!</li>
<li>One Enterprise - One Versioning Approach</li>
</ul></li>
</ul>
<h4
id="hateoas-hypermedia-as-the-engine-of-application-state"><strong>HATEOAS
(Hypermedia as the Engine of Application State)</strong></h4>
<ul>
<li><p>Websites allow you to: See Data AND Perform Actions (using
links)</p></li>
<li><p>How about enhancing your REST API to tell consumers how to
perform subsequent actions?</p>
<ul>
<li><p>HATEOAS (In below image, <code>_links</code> section coming from
<code>hateoas</code>)</p>
<p><img src="images/hateoas.png" alt="transport" style="zoom: 50%;" /></p></li>
</ul></li>
<li><p>Implementation Options:</p>
<ul>
<li>1: Custom Format and Implementation</li>
<li>Difficult to maintain</li>
<li>2: Use Standard Implementation
<ul>
<li>HAL (JSON Hypertext Application Language): Simple format that gives
a consistent and easy way to hyperlink between resources in your
API</li>
<li>Spring HATEOAS: Generate HAL responses with hyperlinks to
resources</li>
</ul></li>
</ul></li>
<li><p>Steps :</p>
<ul>
<li><p>STEP 1: <strong><em>pom.xml</em></strong></p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode xml"><code class="sourceCode xml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">dependency</span>&gt;</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">groupId</span>&gt;org.springframework.boot&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">artifactId</span>&gt;spring-boot-starter-hateoas&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">dependency</span>&gt;</span></code></pre></div></li>
<li><p>STEP 2: <a
href="https://github.com/in28minutes/spring-microservices/blob/master/02.restful-web-services/backup07-improving-documentation-with-swagger.md#srcmainjavacomin28minutesrestwebservicesrestfulwebservicesuseruserresourcejava-1"><strong><em>UserResource.java</em></strong></a>
: Here we have added <code>all-users</code> link section of response
which is of generic type <code>hateoas.Resource</code></p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="kw">static</span><span class="im"> org</span><span class="op">.</span><span class="im">springframework</span><span class="op">.</span><span class="im">hateoas</span><span class="op">.</span><span class="im">mvc</span><span class="op">.</span><span class="im">ControllerLinkBuilder</span><span class="op">.</span><span class="im">linkTo</span><span class="op">;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="kw">static</span><span class="im"> org</span><span class="op">.</span><span class="im">springframework</span><span class="op">.</span><span class="im">hateoas</span><span class="op">.</span><span class="im">mvc</span><span class="op">.</span><span class="im">ControllerLinkBuilder</span><span class="op">.</span><span class="im">methodOn</span><span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">springframework</span><span class="op">.</span><span class="im">hateoas</span><span class="op">.</span><span class="im">Resource</span><span class="op">;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">springframework</span><span class="op">.</span><span class="im">hateoas</span><span class="op">.</span><span class="im">mvc</span><span class="op">.</span><span class="im">ControllerLinkBuilder</span><span class="op">;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">...</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">@RestController</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">class</span> UserResource <span class="op">{</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">@GetMapping</span><span class="op">(</span><span class="st">&quot;/users/{id}&quot;</span><span class="op">)</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="bu">Resource</span><span class="op">&lt;</span>User<span class="op">&gt;</span> <span class="fu">retrieveUser</span><span class="op">(</span><span class="at">@PathVariable</span> <span class="dt">int</span> id<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>            User user <span class="op">=</span> service<span class="op">.</span><span class="fu">findOne</span><span class="op">(</span>id<span class="op">);</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span><span class="op">(</span>user<span class="op">==</span><span class="kw">null</span><span class="op">)</span><span class="cf">throw</span> <span class="kw">new</span> <span class="fu">UserNotFoundException</span><span class="op">(</span><span class="st">&quot;id-&quot;</span><span class="op">+</span> id<span class="op">);</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>            <span class="co">//&quot;all-users&quot;, SERVER_PATH + &quot;/users&quot;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>            <span class="co">//retrieveAllUsers</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>            <span class="bu">Resource</span><span class="op">&lt;</span>User<span class="op">&gt;</span> resource <span class="op">=</span> <span class="kw">new</span> <span class="bu">Resource</span><span class="op">&lt;</span>User<span class="op">&gt;(</span>user<span class="op">);</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>            ControllerLinkBuilder linkTo <span class="op">=</span> <span class="fu">linkTo</span><span class="op">(</span><span class="fu">methodOn</span><span class="op">(</span><span class="kw">this</span><span class="op">.</span><span class="fu">getClass</span><span class="op">()).</span><span class="fu">retrieveAllUsers</span><span class="op">());</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>            resource<span class="op">.</span><span class="fu">add</span><span class="op">(</span>linkTo<span class="op">.</span><span class="fu">withRel</span><span class="op">(</span><span class="st">&quot;all-users&quot;</span><span class="op">));</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>            <span class="co">//HATEOAS</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> resource<span class="op">;</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">@PostMapping</span><span class="op">(</span><span class="st">&quot;/users&quot;</span><span class="op">)</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> ResponseEntity<span class="op">&lt;</span><span class="bu">Object</span><span class="op">&gt;</span> <span class="fu">createUser</span><span class="op">(</span><span class="at">@Valid</span> <span class="at">@RequestBody</span> User user<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>            User savedUser <span class="op">=</span> service<span class="op">.</span><span class="fu">save</span><span class="op">(</span>user<span class="op">);</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>            <span class="co">// CREATED</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>            <span class="co">// /user/{id}     savedUser.getId()</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>            <span class="bu">URI</span> location <span class="op">=</span> ServletUriComponentsBuilder</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">fromCurrentRequest</span><span class="op">()</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">path</span><span class="op">(</span><span class="st">&quot;/{id}&quot;</span><span class="op">)</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">buildAndExpand</span><span class="op">(</span>savedUser<span class="op">.</span><span class="fu">getId</span><span class="op">()).</span><span class="fu">toUri</span><span class="op">();</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> ResponseEntity<span class="op">.</span><span class="fu">created</span><span class="op">(</span>location<span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div></li>
</ul></li>
</ul>
<h4 id="hal-explorer"><strong>HAL Explorer</strong></h4>
<ul>
<li>An API explorer for RESTful Hypermedia APIs using HAL</li>
<li>Enable your non-technical teams to play with APIs</li>
<li>Spring Boot HAL Explorer
<ul>
<li>Auto-configures HAL Explorer for Spring Boot Projects</li>
<li>Import in pom.xml using
<code>spring-data-rest-hal-explorer</code></li>
</ul></li>
</ul>
<p><img src="images/halExplorer.png" alt="transport" style="zoom: 43%;" /></p>
<h1 id="microservicesv1">Microservices(V1)</h1>
<p>This is a older version compatible with Spring boot &lt; 2.3.0, For
newer Versions, Please refer []</p>
<p><strong>Problems and Solutions for each problem :</strong></p>
<ul>
<li>CENTRALIZED CONFIGURATION MANAGEMENT - <strong><em>Spring Cloud
Config Server</em></strong></li>
<li>LOCATION TRANSPARANCY - Naming Server
(<strong><em>Eureka</em></strong>)</li>
<li>LOAD BALANCING - <strong><em>Ribbon</em></strong> (Client Side)</li>
<li>VISIBILITY AND MONITORING -
<ul>
<li><strong><em>Zipkin Distributed Tracing</em></strong></li>
<li><strong><em>Netflix API Gateway</em></strong></li>
</ul></li>
<li>FAULT TOLERANCE - <strong><em>Hystrix</em></strong></li>
</ul>
<hr />
<h1 id="microservicesv3"><strong>Microservices(V3)</strong></h1>
<p><strong><a
href="https://github.com/in28minutes/spring-microservices-v3">Reference
Git Repo</a></strong></p>
<p><strong>Problems and Solutions for each problem :</strong></p>
<ul>
<li>CENTRALIZED CONFIGURATION MANAGEMENT - <strong><em>Spring Cloud
Config Server</em></strong></li>
<li>LOCATION TRANSPARANCY - Naming Server
(<strong><em>Eureka</em></strong>)</li>
<li>LOAD BALANCING - <strong><em>Spring Cloud
Load-balancer</em></strong> instead of <em>Ribbon</em> (Client
Side)</li>
<li>VISIBILITY AND MONITORING -
<ul>
<li><strong><em>Zipkin Distributed Tracing</em></strong></li>
<li><strong><em>Spring Cloud Gateway</em></strong> instead of
<em>Netflix Zuul API Gateway</em></li>
</ul></li>
<li>FAULT TOLERANCE - <strong><em>Resilience4j</em></strong> instead of
<em>Hystrix</em></li>
<li><strong>OpenTelemetry</strong> : One Standard - Logs, Traces &amp;
Metrics</li>
<li><strong>Micrometer</strong> (Replaces Spring Cloud Sleuth)</li>
</ul>
<p><img src="images/dia1.png" alt="transport" style="zoom: 43%;" /></p>
<h3 id="standardized-ports">Standardized Ports</h3>
<table>
<thead>
<tr class="header">
<th>Application</th>
<th>Port</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Limits Service</td>
<td>8080, 8081, …</td>
</tr>
<tr class="even">
<td>Spring Cloud Config Server</td>
<td>8888</td>
</tr>
<tr class="odd">
<td>Currency Exchange Service</td>
<td>8000, 8001, 8002, ..</td>
</tr>
<tr class="even">
<td>Currency Conversion Service</td>
<td>8100, 8101, 8102, …</td>
</tr>
<tr class="odd">
<td>Netflix Eureka Naming Server</td>
<td>8761</td>
</tr>
<tr class="even">
<td>Spring Cloud API Gateway</td>
<td>8765</td>
</tr>
<tr class="odd">
<td>Zipkin Distributed Tracing Server</td>
<td>9411</td>
</tr>
</tbody>
</table>
<h3 id="standardized-urls">Standardized URLs</h3>
<table>
<colgroup>
<col style="width: 31%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="header">
<th>Application</th>
<th>URL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Limits Service</td>
<td><a
href="http://localhost:8080/limits">http://localhost:8080/limits</a>
<br /><a
href="http://localhost:8080/actuator/refresh">http://localhost:8080/actuator/refresh</a>
(POST)</td>
</tr>
<tr class="even">
<td>Spring Cloud Config Server</td>
<td><a
href="http://localhost:8888/limits-service/default">http://localhost:8888/limits-service/default</a>
<br /><a
href="http://localhost:8888/limits-service/dev">http://localhost:8888/limits-service/dev</a></td>
</tr>
<tr class="odd">
<td>Currency Exchange Service</td>
<td><a
href="http://localhost:8000/currency-exchange/from/EUR/to/INR">http://localhost:8000/currency-exchange/from/EUR/to/INR</a>
<br /><a
href="http://localhost:8000/currency-exchange/from/USD/to/INR">http://localhost:8000/currency-exchange/from/USD/to/INR</a></td>
</tr>
<tr class="even">
<td>Currency Conversion Service</td>
<td><a
href="http://localhost:8100/currency-conversion/from/USD/to/INR/quantity/10">http://localhost:8100/currency-conversion/from/USD/to/INR/quantity/10</a></td>
</tr>
<tr class="odd">
<td>Eureka Naming Server</td>
<td><a href="http://localhost:8761/">Eureka Console -
http://localhost:8761/</a></td>
</tr>
<tr class="even">
<td>Spring Cloud API Gateway</td>
<td><a
href="http://localhost:8765/currency-exchange/from/USD/to/INR">http://localhost:8765/currency-exchange/from/USD/to/INR</a><br /><a
href="http://localhost:8765/currency-conversion/from/USD/to/INR/quantity/10">http://localhost:8765/currency-conversion/from/USD/to/INR/quantity/10</a><br /><a
href="http://localhost:8765/currency-conversion-new/from/USD/to/INR/quantity/10">http://localhost:8765/currency-conversion-new/from/USD/to/INR/quantity/10</a></td>
</tr>
<tr class="odd">
<td>Zipkin Distributed Tracing</td>
<td><a
href="http://localhost:9411/zipkin/">http://localhost:9411/zipkin/</a></td>
</tr>
<tr class="even">
<td>Spring Cloud Bus Refresh</td>
<td>http://localhost:8080/actuator/bus-refresh (POST)</td>
</tr>
</tbody>
</table>
<h3 id="hosted-urls">Hosted URLs</h3>
<table>
<colgroup>
<col style="width: 31%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="header">
<th>Application</th>
<th>URL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Limits Service</td>
<td><a
href="http://localhost:8080/limits">http://localhost:8080/limits</a>
<br /><a
href="http://localhost:8080/actuator/refresh">http://localhost:8080/actuator/refresh</a>
(POST)</td>
</tr>
<tr class="even">
<td>Spring Cloud Config Server</td>
<td><a
href="http://localhost:8888/limits-service/default">http://localhost:8888/limits-service/default</a>
<br /><a
href="http://localhost:8888/limits-service/dev">http://localhost:8888/limits-service/dev</a></td>
</tr>
<tr class="odd">
<td>Currency Exchange Service</td>
<td><a
href="http://sg-test.eastus.cloudapp.azure.com:8000/currency-exchange/from/EUR/to/INR">http://sg-test.eastus.cloudapp.azure.com:8000/currency-exchange/from/EUR/to/INR</a>
<br /><a
href="http://sg-test.eastus.cloudapp.azure.com:8000/currency-exchange/from/USD/to/INR">http://sg-test.eastus.cloudapp.azure.com:8000/currency-exchange/from/USD/to/INR</a></td>
</tr>
<tr class="even">
<td>Currency Conversion Service</td>
<td><a
href="http://sg-test.eastus.cloudapp.azure.com:8100/currency-conversion/from/USD/to/INR/quantity/10">http://sg-test.eastus.cloudapp.azure.com:8100/currency-conversion/from/USD/to/INR/quantity/10</a></td>
</tr>
<tr class="odd">
<td>Eureka Naming Server</td>
<td><a
href="http://sg-test.eastus.cloudapp.azure.com:8761/">http://sg-test.eastus.cloudapp.azure.com:8761/</a></td>
</tr>
<tr class="even">
<td>Spring Cloud API Gateway</td>
<td><a
href="http://sg-test.eastus.cloudapp.azure.com:8765/currency-exchange/from/USD/to/INR">http://sg-test.eastus.cloudapp.azure.com:8765/currency-exchange/from/USD/to/INR</a><br /><a
href="http://sg-test.eastus.cloudapp.azure.com:8765/currency-conversion/from/USD/to/INR/quantity/10">http://sg-test.eastus.cloudapp.azure.com:8765/currency-conversion/from/USD/to/INR/quantity/10</a><br /><a
href="http://sg-test.eastus.cloudapp.azure.com:8765/currency-conversion-new/from/USD/to/INR/quantity/10">http://sg-test.eastus.cloudapp.azure.com:8765/currency-conversion-new/from/USD/to/INR/quantity/10</a></td>
</tr>
<tr class="odd">
<td>Zipkin Distributed Tracing</td>
<td><a
href="http://sg-test.eastus.cloudapp.azure.com:9411/zipkin/">http://sg-test.eastus.cloudapp.azure.com:9411/zipkin/</a></td>
</tr>
<tr class="even">
<td>Spring Cloud Bus Refresh</td>
<td>http://localhost:8080/actuator/bus-refresh (POST)</td>
</tr>
</tbody>
</table>
<h2 id="currency-config-repository">Currency Config Repository</h2>
<ul>
<li><p><a href="https://github.com/SwarnadeepGhosh/Microservices">Git
Repo Link</a></p></li>
<li><p>File name pattern :
<strong><code>&lt;microservice-name&gt;-&lt;profile&gt;.properties</code></strong></p></li>
<li><p>Spring Cloud Config Repository is having highest priority. That
means, if someone write same property within project and also he is
fetching that property value from Git repo, then the property of git
repo will overwrite the property value present in microservice property
file.</p></li>
<li><p><strong>STEP 1:</strong> Create property files</p>
<ul>
<li><p><strong><em>limits-service.properties</em></strong></p>
<pre class="properties"><code>limits.service.minimum=4
limits.service.maximum=996</code></pre></li>
<li><p><strong><em>limits-service-dev.properties</em></strong></p>
<pre class="properties"><code>limits.service.minimum=5
limits.service.maximum=995</code></pre></li>
<li><p><strong><em>limits-service-qa.properties</em></strong></p>
<pre class="properties"><code>limits.service.minimum=6
limits.service.maximum=994</code></pre></li>
</ul></li>
<li><p><strong>STEP 2:</strong> Initialize a git repository and push
changes into master branch</p>
<ul>
<li><div class="sourceCode" id="cb10"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>  <span class="ex">$</span> git init</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">$</span> git add .</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">$</span> git commit <span class="at">-m</span> <span class="st">&quot;added files&quot;</span></span></code></pre></div></li>
<li>If its a remote branch , then we need to create api key from :
Github &gt; Settings &gt; Developer Settings</li>
</ul></li>
</ul>
<hr />
<h2 id="config-server-microservice">Config Server Microservice</h2>
<ul>
<li><p><a
href="https://start.spring.io/#!type=maven-project&amp;language=java&amp;platformVersion=3.2.4&amp;packaging=jar&amp;jvmVersion=21&amp;groupId=com.swarna.microservices&amp;artifactId=config-server&amp;name=config-server&amp;description=Centralized%20config%20server%20microservice&amp;packageName=com.swarna.microservices.config-server&amp;dependencies=devtools,cloud-config-server">Starting
Project - Config Server Microservice (Spring.io)</a></p></li>
<li><p><a href="https://github.com/SwarnadeepGhosh/Microservices">Git
Repo Link</a></p></li>
<li><p>Connecting with Git Repo :</p>
<ul>
<li><p><strong>STEP 1</strong> : Import downloaded Zip from
start.spring.io and add <code>@EnableConfigServer</code> annotation in
main class : <strong><em>ConfigServerApplication.java</em></strong></p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">springframework</span><span class="op">.</span><span class="im">cloud</span><span class="op">.</span><span class="im">config</span><span class="op">.</span><span class="im">server</span><span class="op">.</span><span class="im">EnableConfigServer</span><span class="op">;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="at">@EnableConfigServer</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="at">@SpringBootApplication</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ConfigServerApplication <span class="op">{</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="op">{</span> SpringApplication<span class="op">.</span><span class="fu">run</span><span class="op">(</span>ConfigServerApplication<span class="op">.</span><span class="fu">class</span><span class="op">,</span> args<span class="op">);</span> <span class="op">}</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li>
<li><p><strong>STEP 2</strong>:
<strong><em>application.properties</em></strong></p>
<pre class="properties"><code>spring.application.name=config-server
server.port=8888

#Sample URI for local git repo in Windows local system
#spring.cloud.config.server.git.uri=file:///D:/Microservices/config-repo

#Sample URI for Git repo from Github
spring.cloud.config.server.git.uri=https://github.com/SwarnadeepGhosh/currency-config-repo
spring.cloud.config.server.git.default-label=master
spring.cloud.config.server.git.username=SwarnadeepGhosh
spring.cloud.config.server.git.password=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
#spring.cloud.config.server.git.ignore-local-ssh-settings=true
#spring.cloud.config.server.git.private-key=&lt;private-key&gt;</code></pre></li>
<li><p><strong>STEP 3</strong>: Fetch Config using GET api calls :</p>
<ul>
<li>Default: <a
href="http://localhost:8888/limits-service/default">http://localhost:8888/limits-service/default</a></li>
<li>Dev: <a
href="http://localhost:8888/limits-service/dev">http://localhost:8888/limits-service/dev</a></li>
<li>Qa: <a
href="http://localhost:8888/limits-service/qa">http://localhost:8888/limits-service/qa</a></li>
</ul></li>
</ul></li>
</ul>
<hr />
<h2 id="limits-microservice">Limits Microservice</h2>
<ul>
<li><p><a
href="https://start.spring.io/#!type=maven-project&amp;language=java&amp;platformVersion=3.2.4&amp;packaging=jar&amp;jvmVersion=21&amp;groupId=com.swarna.microservices&amp;artifactId=limit-service&amp;name=limit-service&amp;description=Limit%20Microservice&amp;packageName=com.swarna.microservices.limit-service&amp;dependencies=web,devtools,actuator,lombok,cloud-config-client">Starting
Project - Limits Microservice (Spring.io)</a></p></li>
<li><p><a href="https://github.com/SwarnadeepGhosh/Microservices">Git
Repo Link</a></p></li>
<li><p>Connecting with Config server and eventually fetching config from
config repo :</p>
<ul>
<li><p><strong>STEP 1</strong> : Import downloaded Zip from
start.spring.io and add below in
<strong><em>application.properties</em></strong></p>
<pre class="properties"><code>spring.application.name=limits-service
spring.config.import=optional:configserver:http://localhost:8888

spring.profiles.active=dev
spring.cloud.profiles.active=dev</code></pre></li>
<li><p><strong>STEP 2</strong>:
<strong><em>PropertyConfig.java</em></strong> - This will fetch data
from property files, so that we can use it in application.</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="at">@ConfigurationProperties</span><span class="op">(</span><span class="st">&quot;limits.service&quot;</span><span class="op">)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="at">@Component</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="at">@Data</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> PropertyConfig <span class="op">{</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">int</span> minimum<span class="op">;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">int</span> maximum<span class="op">;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li>
<li><p><strong>STEP 3</strong>:
<strong><em>LimitController.java</em></strong> - This will fetch data
from property files, so that we can use it in application.</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="at">@RestController</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> LimitController <span class="op">{</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Autowired</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    PropertyConfig propertyConfig<span class="op">;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">@GetMapping</span><span class="op">(</span><span class="st">&quot;/limits&quot;</span><span class="op">)</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Limits <span class="fu">retrieveLimits</span><span class="op">(){</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">new</span> <span class="fu">Limits</span><span class="op">(</span>propertyConfig<span class="op">.</span><span class="fu">getMinimum</span><span class="op">(),</span> propertyConfig<span class="op">.</span><span class="fu">getMaximum</span><span class="op">());</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li>
<li><p><strong>STEP 3</strong>: Fetch response using GET api calls : <a
href="http://localhost:8080/limits">http://localhost:8080/limits</a> .
Here property coming from git repo to config server and to limit
service.</p></li>
</ul></li>
</ul>
<hr />
<h2 id="currency-exchange">Currency Exchange</h2>
<ul>
<li><p>URLs</p>
<ul>
<li><a
href="https://start.spring.io/#!type=maven-project&amp;language=java&amp;platformVersion=3.2.4&amp;packaging=jar&amp;jvmVersion=21&amp;groupId=com.swarna.microservices&amp;artifactId=currency-exchange&amp;name=currency-exchange&amp;description=Currency%20Exchange%20Microservice&amp;packageName=com.swarna.microservices.currency-exchange&amp;dependencies=web,devtools,actuator,lombok,cloud-config-client">Starting
Project - Currency Exchange Microservice (Spring.io)</a></li>
<li><a href="https://github.com/SwarnadeepGhosh/Microservices">Git Repo
Link</a></li>
<li>H2 Console : <a
href="http://localhost:8000/h2-console">http://localhost:8000/h2-console</a></li>
<li><a
href="http://localhost:8000/currency-exchange/from/USD/to/INR">http://localhost:8000/currency-exchange/from/USD/to/INR</a></li>
</ul></li>
<li><p><strong>Service Working example :</strong></p>
<ul>
<li><p>If you ask it the value of 1 USD in INR, or 1 Australian Dollar
in INR, the Currency Exchange Service answers</p>
<ul>
<li>1 USD is 60 INR</li>
<li>1 Australian Dollars is 50 INR.</li>
</ul>
<p>GET : http://localhost:8000/currency-exchange/from/EUR/to/INR</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="dv">10002</span><span class="fu">,</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;from&quot;</span><span class="fu">:</span> <span class="st">&quot;EUR&quot;</span><span class="fu">,</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;to&quot;</span><span class="fu">:</span> <span class="st">&quot;INR&quot;</span><span class="fu">,</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;conversionMultiple&quot;</span><span class="fu">:</span> <span class="fl">75.00</span><span class="fu">,</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;exchangeEnvironmentInfo&quot;</span><span class="fu">:</span> <span class="st">&quot;37f1ad927c6e v1 27c6e&quot;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div></li>
</ul></li>
<li><p><strong><em>application.properties</em></strong></p>
<pre class="properties"><code>spring.application.name=currency-exchange
server.port=8000

spring.jpa.show-sql=true
spring.datasource.url=jdbc:h2:mem:testdb
spring.jpa.defer-datasource-initialization=true
spring.h2.console.enabled=true

spring.config.import=optional:configserver:

spring.devtools.restart.poll-interval=2s
spring.devtools.restart.quiet-period=1s
spring.devtools.livereload.port=35731</code></pre></li>
</ul>
<hr />
<h2 id="currency-conversion">Currency Conversion</h2>
<ul>
<li><p>URLs</p>
<ul>
<li><a
href="https://start.spring.io/#!type=maven-project&amp;language=java&amp;platformVersion=3.2.4&amp;packaging=jar&amp;jvmVersion=21&amp;groupId=com.swarna.microservices&amp;artifactId=currency-conversion&amp;name=currency-conversion&amp;description=Currency%20Conversion%20Microservice&amp;packageName=com.swarna.microservices.currency-conversion&amp;dependencies=web,devtools,actuator,lombok,cloud-config-client">Starting
Project - Currency Conversion Microservice (Spring.io)</a></li>
<li><a href="https://github.com/SwarnadeepGhosh/Microservices">Git Repo
Link</a></li>
<li><a
href="http://localhost:8100/currency-conversion/from/USD/to/INR/quantity/10">http://localhost:8100/currency-conversion/from/USD/to/INR/quantity/10</a></li>
</ul></li>
<li><p><strong>Service Working example :</strong></p>
<ul>
<li><p>Currency Conversion Service is used to convert a bucket of
currencies. If you want to find the value of 10 USD, Currency Conversion
Service returns 600.</p>
<ul>
<li><strong>STEP 1</strong> : Currency Conversion Service calls the
Currency Exchange Service for the value of 1 USD. It gets a response
back saying 60.</li>
<li><strong>STEP 2</strong> : The Currency Conversion Service then
multiplies 10 by 60, and returns 600 back.</li>
</ul>
<p>GET :
http://localhost:8100/currency-conversion/from/EUR/to/INR/quantity/10</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="dv">10002</span><span class="fu">,</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;from&quot;</span><span class="fu">:</span> <span class="st">&quot;EUR&quot;</span><span class="fu">,</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;to&quot;</span><span class="fu">:</span> <span class="st">&quot;INR&quot;</span><span class="fu">,</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;conversionMultiple&quot;</span><span class="fu">:</span> <span class="fl">75.00</span><span class="fu">,</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;quantity&quot;</span><span class="fu">:</span> <span class="dv">10</span><span class="fu">,</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;totalCalculatedAmount&quot;</span><span class="fu">:</span> <span class="fl">750.00</span><span class="fu">,</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;exchangeEnvironmentInfo&quot;</span><span class="fu">:</span> <span class="st">&quot;37f1ad927c6e v1 27c6e&quot;</span><span class="fu">,</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;conversionEnvironmentInfo&quot;</span><span class="fu">:</span> <span class="st">&quot;fb6316b5713d v1 5713d&quot;</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div></li>
</ul></li>
</ul>
<h3 id="feign-client-integration">Feign Client Integration</h3>
<ul>
<li><p>Most easiest Rest Template call</p></li>
<li><p><strong><em>application.properties</em></strong></p>
<pre class="properties"><code>spring.application.name=currency-conversion
server.port=8100

spring.config.import=optional:configserver:
currency-exchange.url=http://localhost:8000

spring.devtools.restart.poll-interval=2s
spring.devtools.restart.quiet-period=1s
spring.devtools.livereload.port=35730</code></pre></li>
<li><p>Main Interface to make Feign Client Calls :
<strong><em>CurrencyExchangeProxy.java</em></strong></p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">springframework</span><span class="op">.</span><span class="im">cloud</span><span class="op">.</span><span class="im">openfeign</span><span class="op">.</span><span class="im">FeignClient</span><span class="op">;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">springframework</span><span class="op">.</span><span class="im">web</span><span class="op">.</span><span class="im">bind</span><span class="op">.</span><span class="im">annotation</span><span class="op">.</span><span class="im">GetMapping</span><span class="op">;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">springframework</span><span class="op">.</span><span class="im">web</span><span class="op">.</span><span class="im">bind</span><span class="op">.</span><span class="im">annotation</span><span class="op">.</span><span class="im">PathVariable</span><span class="op">;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="at">@FeignClient</span><span class="op">(</span>name <span class="op">=</span> <span class="st">&quot;currency-exchange&quot;</span><span class="op">,</span> url <span class="op">=</span> <span class="st">&quot;${currency-exchange.url}&quot;</span><span class="op">)</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> CurrencyExchangeProxy <span class="op">{</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">@GetMapping</span><span class="op">(</span><span class="st">&quot;/currency-exchange/from/{from}/to/{to}&quot;</span><span class="op">)</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> CurrencyConversion <span class="fu">retrieveExchangeValue</span><span class="op">(</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">@PathVariable</span> <span class="bu">String</span> from<span class="op">,</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">@PathVariable</span> <span class="bu">String</span> to<span class="op">);</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li>
<li><p><strong><em>CurrencyConversionController.java</em></strong></p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="at">@RestController</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> CurrencyConversionController <span class="op">{</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Autowired</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> CurrencyExchangeProxy proxy<span class="op">;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">@GetMapping</span><span class="op">(</span><span class="st">&quot;/currency-conversion/from/{from}/to/{to}/quantity/{quantity}&quot;</span><span class="op">)</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> CurrencyConversion <span class="fu">calculateCurrencyConversionFeign</span><span class="op">(</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">@PathVariable</span> <span class="bu">String</span> from<span class="op">,</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">@PathVariable</span> <span class="bu">String</span> to<span class="op">,</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">@PathVariable</span> <span class="bu">BigDecimal</span> quantity</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">)</span> <span class="op">{</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>        CurrencyConversion currencyConversion <span class="op">=</span> proxy<span class="op">.</span><span class="fu">retrieveExchangeValue</span><span class="op">(</span>from<span class="op">,</span> to<span class="op">);</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> CurrencyConversion<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">id</span><span class="op">(</span>currencyConversion<span class="op">.</span><span class="fu">getId</span><span class="op">())</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">from</span><span class="op">(</span>currencyConversion<span class="op">.</span><span class="fu">getFrom</span><span class="op">())</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">to</span><span class="op">(</span>currencyConversion<span class="op">.</span><span class="fu">getTo</span><span class="op">())</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">quantity</span><span class="op">(</span>quantity<span class="op">)</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">conversionMultiple</span><span class="op">(</span>currencyConversion<span class="op">.</span><span class="fu">getConversionMultiple</span><span class="op">())</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">totalCalculatedAmount</span><span class="op">(</span>quantity<span class="op">.</span><span class="fu">multiply</span><span class="op">(</span>currencyConversion<span class="op">.</span><span class="fu">getConversionMultiple</span><span class="op">()))</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">environment</span><span class="op">(</span>currencyConversion<span class="op">.</span><span class="fu">getEnvironment</span><span class="op">()</span> <span class="op">+</span> <span class="st">&quot; feign&quot;</span><span class="op">)</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li>
</ul>
<hr />
<h2 id="eureka-naming-server"><strong>Eureka Naming Server</strong></h2>
<p><img src="images/namingServer.png" alt="transport" style="zoom: 67%;" /></p>
<ul>
<li><p>Also called <strong>Service Registry</strong></p></li>
<li><p>URLs</p>
<ul>
<li><a
href="https://start.spring.io/#!type=maven-project&amp;language=java&amp;platformVersion=3.2.4&amp;packaging=jar&amp;jvmVersion=21&amp;groupId=com.swarna.microservices&amp;artifactId=naming-server&amp;name=naming-server&amp;description=spring-cloud-netflix%20Eureka%20Naming%20Server%20Microservice&amp;packageName=com.swarna.microservices.naming-server&amp;dependencies=devtools,actuator,cloud-eureka-server">Starting
Project - Eureka naming Server Microservice (Spring.io)</a></li>
<li><a href="https://github.com/SwarnadeepGhosh/Microservices">Git Repo
Link</a></li>
<li><a href="http://localhost:8761/">Eureka Console -
http://localhost:8761/</a></li>
</ul></li>
<li><p><strong>Setting up Eureka Naming Server:</strong></p>
<ul>
<li><p><strong><em>application.properties</em></strong></p>
<pre class="properties"><code>spring.application.name=naming-server
server.port=8761

# We don&#39;t want this specific server to be registered with itself
eureka.client.register-with-eureka=false
eureka.client.fetch-registry=false</code></pre></li>
<li><p><strong><em>NamingServerApplication.java</em></strong></p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">springframework</span><span class="op">.</span><span class="im">cloud</span><span class="op">.</span><span class="im">netflix</span><span class="op">.</span><span class="im">eureka</span><span class="op">.</span><span class="im">server</span><span class="op">.</span><span class="im">EnableEurekaServer</span><span class="op">;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="at">@EnableEurekaServer</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="at">@SpringBootApplication</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> NamingServerApplication <span class="op">{</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        SpringApplication<span class="op">.</span><span class="fu">run</span><span class="op">(</span>NamingServerApplication<span class="op">.</span><span class="fu">class</span><span class="op">,</span> args<span class="op">);</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li>
</ul></li>
<li><p><strong>Registering other microservices with Eureka Naming Server
:</strong></p>
<ul>
<li><p><strong><em>pom.xml</em></strong> - add this dependency.</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode xml"><code class="sourceCode xml"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">dependency</span>&gt;</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">groupId</span>&gt;org.springframework.cloud&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">artifactId</span>&gt;spring-cloud-starter-netflix-eureka-client&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">dependency</span>&gt;</span></code></pre></div></li>
<li><p><strong><em>application.properties</em></strong></p>
<pre class="properties"><code># Eureka
eureka.client.serviceUrl.defaultZone=http://localhost:8761/eureka
eureka.instance.prefer-ip-address=true
# eureka.instance.hostname=localhost

# Actuator
management.endpoints.web.exposure.include=*</code></pre></li>
</ul></li>
<li><p><strong>Final Eureka Console Snapshot</strong>: (Notice the
Registered Instances list)</p>
<p><img src="images/eurekaServer.png" alt="transport" style="zoom: 50%;" /></p></li>
</ul>
<hr />
<h2 id="load-balancing-with-eureka"><strong>Load Balancing with
Eureka</strong></h2>
<p><img src="images/LB.png" alt="transport" style="zoom: 67%;" /></p>
<ul>
<li><p>Here we will run multiple instances of <strong>Currency
Exchange</strong> and load balance them from
<strong>Currency-Conversion</strong> using <strong>Feign, Eureka Naming
Server and Spring Cloud Load balancer.</strong></p></li>
<li><p>Spring Cloud Load balancer comes along with Eureka Naming Server
dependency.</p></li>
<li><p>We will remove the hardcoded url from Feign client :
<strong><em>CurrencyExchangeProxy.java</em></strong> of
<strong>Currency-Conversion</strong></p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">//@FeignClient(name = &quot;currency-exchange&quot;, url = &quot;${currency-exchange.url}&quot;)</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="at">@FeignClient</span><span class="op">(</span>name <span class="op">=</span> <span class="st">&quot;currency-exchange&quot;</span><span class="op">)</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> CurrencyExchangeProxy <span class="op">{</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">@GetMapping</span><span class="op">(</span><span class="st">&quot;/currency-exchange/from/{from}/to/{to}&quot;</span><span class="op">)</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> CurrencyConversion <span class="fu">retrieveExchangeValue</span><span class="op">(</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">@PathVariable</span> <span class="bu">String</span> from<span class="op">,</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">@PathVariable</span> <span class="bu">String</span> to<span class="op">);</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li>
</ul>
<blockquote>
<ul>
<li><strong>By doing this, Feign Client will</strong>
<ul>
<li><strong>Talk to Eureka</strong></li>
<li><strong>Pickup the current running instances of
currency-exchange</strong></li>
<li><strong>Do the load balancing between them
automatically.</strong></li>
</ul></li>
<li><strong>All these magic happens just by removing hardcoded url from
Feign Client.</strong></li>
</ul>
</blockquote>
<hr />
<h2 id="spring-cloud-api-gateway"><strong>Spring Cloud API
Gateway</strong></h2>
<figure>
<img
src="https://miro.medium.com/v2/resize:fit:1400/1*q4JzKYvQCJewGHyiMrO_og.png"
alt="How to Use Spring Cloud Gateway to Dynamically Discover Microservices | by Ruby Valappil | Javarevisited | Medium" />
<figcaption aria-hidden="true">How to Use Spring Cloud Gateway to
Dynamically Discover Microservices | by Ruby Valappil | Javarevisited |
Medium</figcaption>
</figure>
<ul>
<li><p>URLs</p>
<ul>
<li><p><a
href="https://start.spring.io/#!type=maven-project&amp;language=java&amp;platformVersion=3.2.4&amp;packaging=jar&amp;jvmVersion=21&amp;groupId=com.swarna.microservices&amp;artifactId=api-gateway&amp;name=api-gateway&amp;description=API%20Gateway%20Microservice%20using%20Spring%20Cloud%20API%20Gateway&amp;packageName=com.swarna.microservices.api-gateway&amp;dependencies=devtools,actuator,cloud-eureka,cloud-gateway">Starting
Project - Spring Cloud API Gateway Microservice (Spring.io)</a></p></li>
<li><p><a href="https://github.com/SwarnadeepGhosh/Microservices">Git
Repo Link</a></p></li>
<li><p><a href="http://localhost:8761/">Eureka Console -
http://localhost:8761/</a></p></li>
</ul></li>
<li><p>Simple, yet effective way to route to APIs</p></li>
<li><p>Provide cross cutting concerns:</p>
<ul>
<li>Security</li>
<li>Monitoring/metrics</li>
</ul></li>
<li><p>Built on top of Spring WebFlux (Reactive Approach)</p></li>
<li><p><strong>Features</strong>:</p>
<ul>
<li>Match routes on any request attribute</li>
<li>Define Predicates and Filters</li>
<li>Integrates with Spring Cloud Discovery Client (Load Balancing) -
Eureka</li>
<li>Path Rewriting</li>
</ul></li>
<li><p><strong><em>pom.xml</em></strong> - If
<code>spring-cloud-starter-gateway-mvc</code> added into pom, then
change it to <code>spring-cloud-starter-gateway</code>, unless you will
face unnecessary errors.</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode xml"><code class="sourceCode xml"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">dependency</span>&gt;</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">groupId</span>&gt;org.springframework.cloud&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">artifactId</span>&gt;spring-cloud-starter-gateway&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">dependency</span>&gt;</span></code></pre></div></li>
</ul>
<h3 id="auto-routing-with-cloud-gateway-discovery-locator">Auto Routing
with Cloud Gateway Discovery Locator</h3>
<ul>
<li><p><strong><em>application.properties</em></strong> - Here we only
mention eureka url and we need to enable discovery locator to true, so
that Spring Cloud API Gateway will automatically pickup services which
are registered in Eureka Naming Server. Also we are telling api gateway
to use lowercase only as service id.</p>
<pre class="properties"><code>spring.application.name=api-gateway
server.port=8765

eureka.client.serviceUrl.defaultZone=http://localhost:8761/eureka
eureka.instance.prefer-ip-address=true
# eureka.instance.hostname=localhost

spring.cloud.gateway.discovery.locator.enabled=true
spring.cloud.gateway.discovery.locator.lowerCaseServiceId=true
#spring.cloud.gateway.discovery.locator.lower-case-service-id=true
#spring.cloud.gateway.httpserver.wiretap=true
#spring.cloud.gateway.httpclient.wiretap=true

# Actuator
management.endpoints.web.exposure.include=*</code></pre></li>
<li><p><strong>Testing URLS :</strong></p>
<ul>
<li><a
href="http://localhost:8765/currency-exchange/currency-exchange/from/USD/to/INR">http://localhost:8765/currency-exchange/currency-exchange/from/USD/to/INR</a></li>
<li><a
href="http://localhost:8765/currency-conversion/currency-conversion/from/USD/to/INR/quantity/10">http://localhost:8765/currency-conversion/currency-conversion/from/USD/to/INR/quantity/10</a></li>
</ul></li>
<li><p><strong>Points to Note :</strong> if we make 2 instances up of
<code>currency-exchange</code> for e.g. on port 8000 and 8001, then on
hitting these gateway testing urls, will automatically load balanced. I
tried with <a
href="http://localhost:8765/currency-conversion/currency-conversion/from/USD/to/INR/quantity/10">http://localhost:8765/currency-conversion/currency-conversion/from/USD/to/INR/quantity/10</a>
and it sometimes returns data from port 8000 server and sometimes from
port 8001 server.</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="dv">10001</span><span class="fu">,</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;from&quot;</span><span class="fu">:</span> <span class="st">&quot;USD&quot;</span><span class="fu">,</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;to&quot;</span><span class="fu">:</span> <span class="st">&quot;INR&quot;</span><span class="fu">,</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;quantity&quot;</span><span class="fu">:</span> <span class="dv">10</span><span class="fu">,</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;conversionMultiple&quot;</span><span class="fu">:</span> <span class="dv">65</span><span class="fu">,</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;totalCalculatedAmount&quot;</span><span class="fu">:</span> <span class="dv">650</span><span class="fu">,</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;environment&quot;</span><span class="fu">:</span> <span class="st">&quot;8000 feign&quot;</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="dv">10001</span><span class="fu">,</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;from&quot;</span><span class="fu">:</span> <span class="st">&quot;USD&quot;</span><span class="fu">,</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;to&quot;</span><span class="fu">:</span> <span class="st">&quot;INR&quot;</span><span class="fu">,</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;quantity&quot;</span><span class="fu">:</span> <span class="dv">10</span><span class="fu">,</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;conversionMultiple&quot;</span><span class="fu">:</span> <span class="dv">65</span><span class="fu">,</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;totalCalculatedAmount&quot;</span><span class="fu">:</span> <span class="dv">650</span><span class="fu">,</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;environment&quot;</span><span class="fu">:</span> <span class="st">&quot;8001 feign&quot;</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div></li>
<li><p><strong>Eureka Console after turning up below 4 microservices
:</strong></p>
<ul>
<li>API GATEWAY on port 8765</li>
<li>Currency Exchange on port 8000 and 8001</li>
<li>Currency Conversion on port 8100</li>
</ul></li>
</ul>
<p><img src="images/gateway-setup.png" alt="transport" style="zoom: 67%;" /></p>
<h3 id="custom-routing-and-custom-filter-for-specific-api">Custom
Routing and Custom Filter for specific API</h3>
<ul>
<li><p><strong><em>ApiGatewayConfiguration.java</em></strong> - Here we
only mention eureka url and we need to enable discovery locator to true,
so that Spring Cloud API Gateway will automatically pickup services
which are registered in Eureka Naming Server. Also we are telling api
gateway to use lowercase only as service id.</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Configuration</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ApiGatewayConfiguration <span class="op">{</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Bean</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> RouteLocator <span class="fu">gatewayRouter</span><span class="op">(</span>RouteLocatorBuilder builder<span class="op">)</span> <span class="op">{</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">//       Using filters, we can add Request and Response headers and parameters to any requests or response</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> builder<span class="op">.</span><span class="fu">routes</span><span class="op">()</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">route</span><span class="op">(</span>p <span class="op">-&gt;</span> p</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>                        <span class="op">.</span><span class="fu">path</span><span class="op">(</span><span class="st">&quot;/get&quot;</span><span class="op">)</span> <span class="co">// Example</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>                        <span class="op">.</span><span class="fu">filters</span><span class="op">(</span>f <span class="op">-&gt;</span> f</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>                                <span class="op">.</span><span class="fu">addRequestHeader</span><span class="op">(</span><span class="st">&quot;MyHeader&quot;</span><span class="op">,</span> <span class="st">&quot;Swarna-header&quot;</span><span class="op">)</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>                                <span class="op">.</span><span class="fu">addRequestParameter</span><span class="op">(</span><span class="st">&quot;Param&quot;</span><span class="op">,</span> <span class="st">&quot;Swarna-param&quot;</span><span class="op">))</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>                        <span class="op">.</span><span class="fu">uri</span><span class="op">(</span><span class="st">&quot;http://httpbin.org:80&quot;</span><span class="op">))</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">route</span><span class="op">(</span>p <span class="op">-&gt;</span> p<span class="op">.</span><span class="fu">path</span><span class="op">(</span><span class="st">&quot;/currency-exchange/**&quot;</span><span class="op">)</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>                        <span class="op">.</span><span class="fu">uri</span><span class="op">(</span><span class="st">&quot;lb://currency-exchange&quot;</span><span class="op">))</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">route</span><span class="op">(</span>p <span class="op">-&gt;</span> p<span class="op">.</span><span class="fu">path</span><span class="op">(</span><span class="st">&quot;/currency-conversion/**&quot;</span><span class="op">)</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>                        <span class="op">.</span><span class="fu">uri</span><span class="op">(</span><span class="st">&quot;lb://currency-conversion&quot;</span><span class="op">))</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">route</span><span class="op">(</span>p <span class="op">-&gt;</span> p<span class="op">.</span><span class="fu">path</span><span class="op">(</span><span class="st">&quot;/currency-conversion-feign/**&quot;</span><span class="op">)</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>                        <span class="op">.</span><span class="fu">uri</span><span class="op">(</span><span class="st">&quot;lb://currency-conversion&quot;</span><span class="op">))</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">route</span><span class="op">(</span>p <span class="op">-&gt;</span> p<span class="op">.</span><span class="fu">path</span><span class="op">(</span><span class="st">&quot;/currency-conversion-new/**&quot;</span><span class="op">)</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>                        <span class="op">.</span><span class="fu">filters</span><span class="op">(</span>f <span class="op">-&gt;</span> f<span class="op">.</span><span class="fu">rewritePath</span><span class="op">(</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;/currency-conversion-new/(?&lt;segment&gt;.*)&quot;</span><span class="op">,</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;/currency-conversion/${segment}&quot;</span><span class="op">))</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>                        <span class="op">.</span><span class="fu">uri</span><span class="op">(</span><span class="st">&quot;lb://currency-conversion&quot;</span><span class="op">))</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li>
<li><p><strong>Testing URLS :</strong></p>
<ul>
<li><p>Custom Forwarding : <a
href="http://localhost:8765/currency-exchange/from/USD/to/INR">http://localhost:8765/currency-exchange/from/USD/to/INR</a></p></li>
<li><p>Custom Forwarding : <a
href="http://localhost:8765/currency-conversion/from/USD/to/INR/quantity/10">http://localhost:8765/currency-conversion/from/USD/to/INR/quantity/10</a></p></li>
<li><p>Path Rewriting : <a
href="http://localhost:8765/currency-conversion-feign/from/USD/to/INR/quantity/10">http://localhost:8765/currency-conversion-feign/from/USD/to/INR/quantity/10</a></p></li>
<li><p>Path Rewriting : <a
href="http://localhost:8765/currency-conversion-new/from/USD/to/INR/quantity/10">http://localhost:8765/currency-conversion-new/from/USD/to/INR/quantity/10</a></p></li>
<li><p>Header and Parameter Injection : <a
href="http://localhost:8765/get">http://localhost:8765/get</a></p>
<ul>
<li><p>Response : Original response is coming from <a
href="http://httpbin.org:80">http://httpbin.org:80</a>, but here we are
injecting <code>"Param": "Swarna-param"</code> and
<code>"Myheader": "Swarna-header",</code></p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;args&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Param&quot;</span><span class="fu">:</span> <span class="st">&quot;Swarna-param&quot;</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span> </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;headers&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Accept&quot;</span><span class="fu">:</span> <span class="st">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&quot;</span><span class="fu">,</span> </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Accept-Encoding&quot;</span><span class="fu">:</span> <span class="st">&quot;gzip, deflate, br, zstd&quot;</span><span class="fu">,</span> </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Accept-Language&quot;</span><span class="fu">:</span> <span class="st">&quot;en-US,en;q=0.9,bn;q=0.8&quot;</span><span class="fu">,</span> </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Cache-Control&quot;</span><span class="fu">:</span> <span class="st">&quot;max-age=0&quot;</span><span class="fu">,</span> </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Content-Length&quot;</span><span class="fu">:</span> <span class="st">&quot;0&quot;</span><span class="fu">,</span> </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Cookie&quot;</span><span class="fu">:</span> <span class="st">&quot;ext_name=ojplmecpdpgccookcobabopnaifgidhf&quot;</span><span class="fu">,</span> </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Forwarded&quot;</span><span class="fu">:</span> <span class="st">&quot;proto=http;host=</span><span class="ch">\&quot;</span><span class="st">localhost:8765</span><span class="ch">\&quot;</span><span class="st">;for=</span><span class="ch">\&quot;</span><span class="st">[0:0:0:0:0:0:0:1]:53507</span><span class="ch">\&quot;</span><span class="st">&quot;</span><span class="fu">,</span> </span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Host&quot;</span><span class="fu">:</span> <span class="st">&quot;httpbin.org&quot;</span><span class="fu">,</span> </span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Myheader&quot;</span><span class="fu">:</span> <span class="st">&quot;Swarna-header&quot;</span><span class="fu">,</span> </span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Sec-Ch-Ua&quot;</span><span class="fu">:</span> <span class="st">&quot;</span><span class="ch">\&quot;</span><span class="st">Google Chrome</span><span class="ch">\&quot;</span><span class="st">;v=</span><span class="ch">\&quot;</span><span class="st">123</span><span class="ch">\&quot;</span><span class="st">, </span><span class="ch">\&quot;</span><span class="st">Not:A-Brand</span><span class="ch">\&quot;</span><span class="st">;v=</span><span class="ch">\&quot;</span><span class="st">8</span><span class="ch">\&quot;</span><span class="st">, </span><span class="ch">\&quot;</span><span class="st">Chromium</span><span class="ch">\&quot;</span><span class="st">;v=</span><span class="ch">\&quot;</span><span class="st">123</span><span class="ch">\&quot;</span><span class="st">&quot;</span><span class="fu">,</span> </span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Sec-Ch-Ua-Mobile&quot;</span><span class="fu">:</span> <span class="st">&quot;?0&quot;</span><span class="fu">,</span> </span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Sec-Ch-Ua-Platform&quot;</span><span class="fu">:</span> <span class="st">&quot;</span><span class="ch">\&quot;</span><span class="st">Windows</span><span class="ch">\&quot;</span><span class="st">&quot;</span><span class="fu">,</span> </span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Sec-Fetch-Dest&quot;</span><span class="fu">:</span> <span class="st">&quot;document&quot;</span><span class="fu">,</span> </span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Sec-Fetch-Mode&quot;</span><span class="fu">:</span> <span class="st">&quot;navigate&quot;</span><span class="fu">,</span> </span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Sec-Fetch-Site&quot;</span><span class="fu">:</span> <span class="st">&quot;none&quot;</span><span class="fu">,</span> </span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Sec-Fetch-User&quot;</span><span class="fu">:</span> <span class="st">&quot;?1&quot;</span><span class="fu">,</span> </span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Upgrade-Insecure-Requests&quot;</span><span class="fu">:</span> <span class="st">&quot;1&quot;</span><span class="fu">,</span> </span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;User-Agent&quot;</span><span class="fu">:</span> <span class="st">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36&quot;</span><span class="fu">,</span> </span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;X-Amzn-Trace-Id&quot;</span><span class="fu">:</span> <span class="st">&quot;Root=1-661d318e-4c8bb3de1028d40a6f5e07e5&quot;</span><span class="fu">,</span> </span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;X-Forwarded-Host&quot;</span><span class="fu">:</span> <span class="st">&quot;localhost:8765&quot;</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span> </span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;origin&quot;</span><span class="fu">:</span> <span class="st">&quot;0:0:0:0:0:0:0:1, 202.78.234.91&quot;</span><span class="fu">,</span> </span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;url&quot;</span><span class="fu">:</span> <span class="st">&quot;http://localhost:8765/get?Param=Swarna-param&quot;</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div></li>
</ul></li>
</ul></li>
</ul>
<h3 id="gateway-global-filters">Gateway Global Filters</h3>
<ul>
<li><p><strong><em>LoggingFilter.java</em></strong> - Here we only
intercepting all requests, adding a log for that and returning that same
request without any modification.</p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span><span class="im"> com</span><span class="op">.</span><span class="im">swarna</span><span class="op">.</span><span class="im">microservices</span><span class="op">.</span><span class="im">apigateway</span><span class="op">.</span><span class="im">beans</span><span class="op">;</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">slf4j</span><span class="op">.</span><span class="im">Logger</span><span class="op">;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">slf4j</span><span class="op">.</span><span class="im">LoggerFactory</span><span class="op">;</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">springframework</span><span class="op">.</span><span class="im">cloud</span><span class="op">.</span><span class="im">gateway</span><span class="op">.</span><span class="im">filter</span><span class="op">.</span><span class="im">GatewayFilterChain</span><span class="op">;</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">springframework</span><span class="op">.</span><span class="im">cloud</span><span class="op">.</span><span class="im">gateway</span><span class="op">.</span><span class="im">filter</span><span class="op">.</span><span class="im">GlobalFilter</span><span class="op">;</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">springframework</span><span class="op">.</span><span class="im">stereotype</span><span class="op">.</span><span class="im">Component</span><span class="op">;</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">springframework</span><span class="op">.</span><span class="im">web</span><span class="op">.</span><span class="im">server</span><span class="op">.</span><span class="im">ServerWebExchange</span><span class="op">;</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">reactor</span><span class="op">.</span><span class="im">core</span><span class="op">.</span><span class="im">publisher</span><span class="op">.</span><span class="im">Mono</span><span class="op">;</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="at">@Component</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> LoggingFilter <span class="kw">implements</span> GlobalFilter <span class="op">{</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="bu">Logger</span> logger <span class="op">=</span> LoggerFactory<span class="op">.</span><span class="fu">getLogger</span><span class="op">(</span>LoggingFilter<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Mono<span class="op">&lt;</span><span class="bu">Void</span><span class="op">&gt;</span> <span class="fu">filter</span><span class="op">(</span>ServerWebExchange exchange<span class="op">,</span> GatewayFilterChain chain<span class="op">)</span> <span class="op">{</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;Path of the request received -&gt; {}&quot;</span><span class="op">,</span> exchange<span class="op">.</span><span class="fu">getRequest</span><span class="op">().</span><span class="fu">getPath</span><span class="op">());</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> chain<span class="op">.</span><span class="fu">filter</span><span class="op">(</span>exchange<span class="op">);</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="co">/* Logs : </span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="co">c.s.m.apigateway.beans.LoggingFilter: Path of the request received -&gt; /currency-conversion/from/USD/to/INR/quantity/10</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="co">c.s.m.apigateway.beans.LoggingFilter: Path of the request received -&gt; /get</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a><span class="co">c.s.m.apigateway.beans.LoggingFilter: Path of the request received -&gt; /currency-exchange/from/USD/to/INR</span></span></code></pre></div></li>
</ul>
<hr />
<h2 id="circuit-breaker--resilience4j"><strong>Circuit Breaker-
Resilience4j</strong></h2>
<figure>
<img
src="https://techburps-7.s3.ap-south-1.amazonaws.com/tech-blog/spring-cloud-circuit-breaker-resilience4j.png"
alt="Circuit Breaker in Spring Cloud (Spring BOOT + Resilience4j)" />
<figcaption aria-hidden="true">Circuit Breaker in Spring Cloud (Spring
BOOT + Resilience4j)</figcaption>
</figure>
<ul>
<li><p><strong>There are lots of microservices. What if one of the
services is down or is slow?</strong></p>
<ul>
<li>Impacts entire chain!</li>
</ul></li>
<li><p><strong>Questions:</strong></p>
<ul>
<li>Can we return a fallback response if a service is down?</li>
<li>Can we implement a Circuit Breaker pattern to reduce load?</li>
<li>Can we retry requests in case of temporary failures?</li>
<li>Can we implement rate limiting?</li>
</ul></li>
<li><p><strong>Solution: Circuit Breaker Framework -
<u>Resilience4j</u></strong></p></li>
<li><ul>
<li>Dependency Setup - <strong><em>pom.xml</em></strong></li>
</ul>
<div class="sourceCode" id="cb34"><pre
class="sourceCode xml"><code class="sourceCode xml"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">dependency</span>&gt;</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">groupId</span>&gt;org.springframework.boot&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">artifactId</span>&gt;spring-boot-starter-aop&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">dependency</span>&gt;</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">dependency</span>&gt;</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">groupId</span>&gt;io.github.resilience4j&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">artifactId</span>&gt;resilience4j-spring-boot2&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">dependency</span>&gt;</span></code></pre></div></li>
</ul>
<p><strong>Different Patterns of Resilience4j</strong></p>
<ul>
<li><p><strong><code>@Retry</code></strong> - We can use default Retry
configuration (Retry attempt = 3) by adding
<code>@Retry(name = "default")</code>, We can also customize retry for a
specific api this way : <code>@Retry(name = "sample-api")</code></p>
<ul>
<li><p><strong><em>CircuitBreakerController.java</em></strong> - here we
have setup custom retry by adding
<code>@Retry(name = "sample-api"</code> and defined a
<code>fallbackMethod</code> for the same.</p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span><span class="im"> com</span><span class="op">.</span><span class="im">swarna</span><span class="op">.</span><span class="im">microservices</span><span class="op">.</span><span class="im">currencyexchange</span><span class="op">.</span><span class="im">beans</span><span class="op">;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="at">@RestController</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="at">@Slf4j</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> CircuitBreakerController <span class="op">{</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">@GetMapping</span><span class="op">(</span><span class="st">&quot;/sample-api&quot;</span><span class="op">)</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">//    @Retry(name = &quot;default&quot;, fallbackMethod = &quot;hardcodedResponse&quot;)</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Retry</span><span class="op">(</span>name <span class="op">=</span> <span class="st">&quot;sample-api&quot;</span><span class="op">,</span> fallbackMethod <span class="op">=</span> <span class="st">&quot;hardcodedResponse&quot;</span><span class="op">)</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">sampleApi</span><span class="op">(){</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>        log<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;Sample API call received&quot;</span><span class="op">);</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>        ResponseEntity<span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> forEntity <span class="op">=</span> <span class="kw">new</span> <span class="fu">RestTemplate</span><span class="op">().</span><span class="fu">getForEntity</span><span class="op">(</span><span class="st">&quot;http://dummy-url:8080&quot;</span><span class="op">,</span> <span class="bu">String</span><span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> forEntity<span class="op">.</span><span class="fu">getBody</span><span class="op">();</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">hardcodedResponse</span><span class="op">(</span><span class="bu">Exception</span> ex<span class="op">)</span> <span class="op">{</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;fallback-response&quot;</span><span class="op">;</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li>
<li><p><strong><em>application.properties</em></strong></p>
<pre class="properties"><code>resilience4j.retry.instances.sample-api.maxAttempts=5 
resilience4j.retry.instances.sample-api.waitDuration=1s
resilience4j.retry.instances.sample-api.enableExponentialBackoff=true</code></pre></li>
<li><p>Fallback method :</p></li>
</ul></li>
<li><p><strong><code>@CircuitBreaker</code></strong> - The <strong><a
href="https://www.baeldung.com/resilience4j#circuit-breaker">circuit
breaker pattern</a> protects a downstream service</strong> by
restricting the upstream service from calling the downstream service
during a partial or complete downtime.</p>
<ul>
<li><p>The CircuitBreaker is implemented via a finite state machine with
three normal states: CLOSED, OPEN and HALF_OPEN and two special states
DISABLED and FORCED_OPEN.</p>
<figure>
<img src="https://files.readme.io/39cdd54-state_machine.jpg"
alt="426" />
<figcaption aria-hidden="true">426</figcaption>
</figure></li>
<li><p>The CircuitBreaker uses a sliding window to store and aggregate
the outcome of calls. You can choose between a count-based sliding
window and a time-based sliding window. The count-based sliding window
aggregrates the outcome of the last N calls. The time-based sliding
window aggregrates the outcome of the calls of the last N
seconds.</p></li>
<li><p><strong><em>CircuitBreakerController.java</em></strong></p>
<div class="sourceCode" id="cb37"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">...</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">@GetMapping</span><span class="op">(</span><span class="st">&quot;/sample-api&quot;</span><span class="op">)</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">//    @Retry(name = &quot;default&quot;, fallbackMethod = &quot;hardcodedResponse&quot;)</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">//    @Retry(name = &quot;sample-api&quot;, fallbackMethod = &quot;hardcodedResponse&quot;)</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">@CircuitBreaker</span><span class="op">(</span>name <span class="op">=</span> <span class="st">&quot;default&quot;</span><span class="op">,</span> fallbackMethod <span class="op">=</span> <span class="st">&quot;hardcodedResponse&quot;</span><span class="op">)</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">sampleApi</span><span class="op">(){</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">...</span></span></code></pre></div></li>
<li><p><strong><em>application.properties</em></strong></p>
<pre class="properties"><code>resilience4j.circuitbreaker.instances.default.failureRateThreshold=90</code></pre></li>
</ul></li>
<li><p><strong><code>@RateLimiter</code></strong> - Below property means
that application will only allow 2 hits for 10 second period.</p>
<ul>
<li><p><strong><em>CircuitBreakerController.java</em></strong></p>
<div class="sourceCode" id="cb39"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">...</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">@GetMapping</span><span class="op">(</span><span class="st">&quot;/sample-api&quot;</span><span class="op">)</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">//    @Retry(name = &quot;default&quot;, fallbackMethod = &quot;hardcodedResponse&quot;)</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">//    @Retry(name = &quot;sample-api&quot;, fallbackMethod = &quot;hardcodedResponse&quot;)</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">//    @CircuitBreaker(name = &quot;default&quot;, fallbackMethod = &quot;hardcodedResponse&quot;)</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">@RateLimiter</span><span class="op">(</span>name <span class="op">=</span> <span class="st">&quot;default&quot;</span><span class="op">)</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">sampleApi</span><span class="op">(){</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">...</span></span></code></pre></div></li>
<li><p><strong><em>application.properties</em></strong></p>
<pre class="properties"><code>resilience4j.ratelimiter.instances.default.limitForPeriod=2
resilience4j.ratelimiter.instances.default.limitRefreshPeriod=10s</code></pre></li>
</ul></li>
<li><p><strong><code>@Bulkhead</code></strong> - How many concurrent
calls are allowed. Bulkhead is one of the patterns provided by
Resilience4J to prevent the cascading failure of an application by
limiting the resources used by a failed component.</p>
<ul>
<li><p>In a microservices architecture, bulkheads are important to
ensure that a failure in one service does not bring down the entire
system. By isolating services and creating separate pools of resources,
a bulkhead can prevent a failure in one service from affecting other
services in the system.</p></li>
<li><p><strong><em>CircuitBreakerController.java</em></strong></p>
<div class="sourceCode" id="cb41"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">...</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">@GetMapping</span><span class="op">(</span><span class="st">&quot;/sample-api&quot;</span><span class="op">)</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">//    @Retry(name = &quot;default&quot;, fallbackMethod = &quot;hardcodedResponse&quot;)</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">//    @Retry(name = &quot;sample-api&quot;, fallbackMethod = &quot;hardcodedResponse&quot;)</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">//    @CircuitBreaker(name = &quot;default&quot;, fallbackMethod = &quot;hardcodedResponse&quot;)</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">//    @RateLimiter(name = &quot;default&quot;)</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Bulkhead</span><span class="op">(</span>name <span class="op">=</span> <span class="st">&quot;default&quot;</span><span class="op">)</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">sampleApi</span><span class="op">(){</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">...</span></span></code></pre></div></li>
<li><p><strong><em>application.properties</em></strong></p>
<pre class="properties"><code>resilience4j.bulkhead.instances.default.maxConcurrentCalls=10
resilience4j.bulkhead.instances.sample-api.maxConcurrentCalls=10</code></pre></li>
</ul></li>
</ul>
<hr />
<h2 id="observability-and-opentelemetry"><strong>Observability and
OpenTelemetry</strong></h2>
<ul>
<li><strong>Monitoring</strong> is reactive while Observability is
proactive. Monitoring is a subset of Observability.</li>
<li><strong>Observability</strong> - Ability of a system to measure its
current state based on the generated data. How well do you understand
whats happening in a system?
<ul>
<li><strong>STEP I</strong> : Gather data, metrics, logs, traces.</li>
<li><strong>STEP II :</strong> Get Intelligence : AI/OPS and anomaly
detection.</li>
</ul></li>
<li><strong>OpenTelemetry</strong>: One Standard for Logs + Traces +
Metrics. This is a collection of tools, APIs, SDKs to instrument,
generate, collect &amp; export telemetry data (Logs + Traces + Metrics).
<ul>
<li><strong>Need of OpenTelemetry</strong> : All applications having
Logs + Traces + Metrics, so <strong>why do we need seperate standard for
each one of these</strong> ?</li>
<li>OpenTelemetry is a <strong>single standard for telemetry
data</strong> (Logs + Traces + Metrics).</li>
<li>Cross Language</li>
<li>Cross Platform</li>
</ul></li>
<li><strong>Micrometer</strong> (Replaces Spring Cloud Sleuth)
<ul>
<li>Collect (Logs + Traces + Metrics)</li>
</ul></li>
</ul>
<hr />
<h2 id="zipkin---distributed-tracing"><strong>Zipkin - Distributed
Tracing</strong></h2>
<p>URLs</p>
<ul>
<li><p><a
href="https://github.com/in28minutes/spring-microservices-v3/blob/main/v3-upgrade.md">Github
Reference LInk</a></p></li>
<li><p><a href="https://github.com/SwarnadeepGhosh/Microservices">Git
Repo Link</a></p></li>
<li><p><a href="http://localhost:9411/zipkin">Zipkin Console -
http://localhost:9411/zipkin</a></p></li>
<li><p>Problems :</p>
<ul>
<li>Complex call chain</li>
<li>How do you debug problems?</li>
<li>How do you trace requests across microservices?</li>
</ul></li>
<li><p>Solution : Enter Distributed Tracing</p></li>
<li><p><img src="images/distributedTracing.png" alt="transport" style="zoom: 67%;" /></p></li>
<li><p>Start Zipkin Server :</p>
<div class="sourceCode" id="cb43"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-p</span> 9411:9411 openzipkin/zipkin:2.23</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Access running zipkin at http://localhost:9411/zipkin</span></span></code></pre></div></li>
<li><p><img src="images/zipkin.png" alt="transport" style="zoom: 67%;" /></p></li>
</ul>
<h3 id="connecting-zipkin-with-other-microservices">Connecting Zipkin
with other Microservices</h3>
<p>We need to add dependencies and properties in other microservices
i.e. <code>api-gateway</code>, <code>currency-exchange</code> and
<code>currency-conversion</code> to connect them with Zipkin.</p>
<ul>
<li><p><u>STEP 1:</u> <strong><em>pom.xml</em></strong>, To enable
Tracing in feign, we need to add <code>feign-micrometer</code>
dependency in <code>currency-conversion</code> microservice.</p>
<div class="sourceCode" id="cb44"><pre
class="sourceCode xml"><code class="sourceCode xml"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>        <span class="co">&lt;!-- SB3 :  Micrometer &gt; OpenTelemetry &gt; Zipkin --&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">&lt;!-- Micrometer - Vendor-neutral application observability facade.</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">            Instrument your JVM-based application code without vendor lock-in.</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co">            Observation (Metrics &amp; Logs) + Tracing.</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co">        --&gt;</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">dependency</span>&gt;</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">groupId</span>&gt;io.micrometer&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">artifactId</span>&gt;micrometer-observation&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">dependency</span>&gt;</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">&lt;!-- OPTION 1: Open Telemetry as Bridge (RECOMMENDED) --&gt;</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">&lt;!-- Open Telemetry</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co">            - Simplified Observability (metrics, logs, and traces) --&gt;</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">dependency</span>&gt;</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">groupId</span>&gt;io.micrometer&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">artifactId</span>&gt;micrometer-tracing-bridge-otel&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">dependency</span>&gt;</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">dependency</span>&gt;</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">groupId</span>&gt;io.opentelemetry&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">artifactId</span>&gt;opentelemetry-exporter-zipkin&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">dependency</span>&gt;</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">&lt;!-- Enables tracing of REST API calls made using Feign - V3 ONLY--&gt;</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">dependency</span>&gt;</span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">groupId</span>&gt;io.github.openfeign&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">artifactId</span>&gt;feign-micrometer&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">dependency</span>&gt;</span></code></pre></div></li>
<li><p><u>STEP 2</u>:
<strong><em>application.properties</em></strong></p>
<pre class="properties"><code># Zipkin
management.tracing.sampling.probability=1.0
logging.pattern.level=%5p [${spring.application.name:},%X{traceId:-},%X{spanId:-}]</code></pre></li>
<li><p><u>STEP 3: <strong>Testing</strong></u> : Below url calls
api-gateway, currency conversion and currency exchange:</p>
<ul>
<li><a
href="http://localhost:8765/currency-conversion/from/USD/to/INR/quantity/10">http://localhost:8765/currency-conversion/from/USD/to/INR/quantity/10</a></li>
<li>Tracing Snapshot of Zipkin :</li>
<li><img src="images/zipkin2.png" alt="transport" style="zoom: 67%;" /></li>
</ul></li>
</ul>
<hr />
<h2 id="docker---container-orchestration">Docker - Container
Orchestration</h2>
<h3 id="create-docker-image">Create Docker Image</h3>
<ul>
<li><p>We can use maven plugin to create docker image.</p></li>
<li><p><strong><em>pom.xml</em></strong> - Need to mention image name.
By default <code>pullPolicy</code> is <code>ALWAYS</code>. We are
setting it to pull <code>IF_NOT_PRESENT</code>, so it will check in
local first. If plugin image present in local, it will not pull.</p>
<div class="sourceCode" id="cb46"><pre
class="sourceCode xml"><code class="sourceCode xml"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">plugin</span>&gt;</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">groupId</span>&gt;org.springframework.boot&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">artifactId</span>&gt;spring-boot-maven-plugin&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">configuration</span>&gt;</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">image</span>&gt;</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">name</span>&gt;swarnadeepghosh/ms-${project.artifactId}:${project.version}&lt;/<span class="kw">name</span>&gt;</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">image</span>&gt;</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">pullPolicy</span>&gt;IF_NOT_PRESENT&lt;/<span class="kw">pullPolicy</span>&gt;</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">excludes</span>&gt;</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">exclude</span>&gt;</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">groupId</span>&gt;org.projectlombok&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">artifactId</span>&gt;lombok&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>            &lt;/<span class="kw">exclude</span>&gt;</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">excludes</span>&gt;</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">configuration</span>&gt;</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">plugin</span>&gt;</span></code></pre></div></li>
<li><p><strong>Commands</strong> :</p>
<ul>
<li><p>Build Docker Image</p>
<div class="sourceCode" id="cb47"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mvn spring-boot:build-image <span class="at">-DskipTests</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2nd approach (Need to add a Dockerfile for this to work)</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker build <span class="at">-t</span> swarnadeepghosh/ms-currency-exchange:0.0.1-SNAPSHOT .</span></code></pre></div></li>
<li><p>Run Docker image</p>
<div class="sourceCode" id="cb48"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">-p</span> 8000:8000 <span class="at">-d</span> <span class="at">--name</span><span class="op">=</span>currency-exchange swarnadeepghosh/ms-currency-exchange:0.0.1-SNAPSHOT</span></code></pre></div></li>
<li><p>Push Docker Image to DockerHub</p>
<div class="sourceCode" id="cb49"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker push docker.io/swarnadeepghosh/ms-currency-exchange:1.0</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker push docker.io/swarnadeepghosh/ms-currency-conversion:1.0</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker push docker.io/swarnadeepghosh/ms-api-gateway:1.0</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker push docker.io/swarnadeepghosh/ms-naming-server:1.0</span></code></pre></div></li>
</ul></li>
</ul>
<h3 id="docker-compose">Docker Compose</h3>
<p>We can start / stop all microservices by a single click using
<code>docker-compose</code></p>
<ul>
<li><p><strong><em>docker-compose.yml</em></strong></p>
<div class="sourceCode" id="cb50"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3.7&#39;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">currency-exchange</span><span class="kw">:</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> swarnadeepghosh/ms-currency-exchange:1.0</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mem_limit</span><span class="kw">:</span><span class="at"> 700m</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;8000:8000&quot;</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> currency-network</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> naming-server</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">EUREKA.CLIENT.SERVICEURL.DEFAULTZONE</span><span class="kw">:</span><span class="at"> http://naming-server:8761/eureka</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">MANAGEMENT.ZIPKIN.TRACING.ENDPOINT</span><span class="kw">:</span><span class="at"> http://zipkin-server:9411/api/v2/spans</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">currency-conversion</span><span class="kw">:</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> swarnadeepghosh/ms-currency-conversion:1.0</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mem_limit</span><span class="kw">:</span><span class="at"> 700m</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;8100:8100&quot;</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> currency-network</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> naming-server</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">EUREKA.CLIENT.SERVICEURL.DEFAULTZONE</span><span class="kw">:</span><span class="at"> http://naming-server:8761/eureka</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">MANAGEMENT.ZIPKIN.TRACING.ENDPOINT</span><span class="kw">:</span><span class="at"> http://zipkin-server:9411/api/v2/spans</span></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">api-gateway</span><span class="kw">:</span></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> swarnadeepghosh/ms-api-gateway:1.0</span></span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mem_limit</span><span class="kw">:</span><span class="at"> 700m</span></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;8765:8765&quot;</span></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> currency-network</span></span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> naming-server</span></span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">EUREKA.CLIENT.SERVICEURL.DEFAULTZONE</span><span class="kw">:</span><span class="at"> http://naming-server:8761/eureka</span></span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">MANAGEMENT.ZIPKIN.TRACING.ENDPOINT</span><span class="kw">:</span><span class="at"> http://zipkin-server:9411/api/v2/spans</span></span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">naming-server</span><span class="kw">:</span></span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> swarnadeepghosh/ms-naming-server:1.0</span></span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mem_limit</span><span class="kw">:</span><span class="at"> 700m</span></span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;8761:8761&quot;</span></span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> currency-network</span></span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-52"><a href="#cb50-52" aria-hidden="true" tabindex="-1"></a><span class="co">  #docker run -p 9411:9411 openzipkin/zipkin:2.23</span></span>
<span id="cb50-53"><a href="#cb50-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-54"><a href="#cb50-54" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">zipkin-server</span><span class="kw">:</span></span>
<span id="cb50-55"><a href="#cb50-55" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> openzipkin/zipkin:2.23</span></span>
<span id="cb50-56"><a href="#cb50-56" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mem_limit</span><span class="kw">:</span><span class="at"> 300m</span></span>
<span id="cb50-57"><a href="#cb50-57" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb50-58"><a href="#cb50-58" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;9411:9411&quot;</span></span>
<span id="cb50-59"><a href="#cb50-59" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb50-60"><a href="#cb50-60" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> currency-network</span></span>
<span id="cb50-61"><a href="#cb50-61" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">restart</span><span class="kw">:</span><span class="at"> always</span><span class="co"> #Restart if there is a problem starting up</span></span>
<span id="cb50-62"><a href="#cb50-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-63"><a href="#cb50-63" aria-hidden="true" tabindex="-1"></a><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb50-64"><a href="#cb50-64" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">currency-network</span><span class="kw">:</span></span></code></pre></div></li>
<li><p>Commands :</p>
<div class="sourceCode" id="cb51"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># turn up server in detached mode</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker compose up <span class="at">-d</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Stop and remove containers, networks</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker compose down</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Stop services</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker compose stop</span></code></pre></div></li>
</ul>
<hr />
<h2 id="kubernetes">Kubernetes</h2>
<hr />
<h1 id="todo">#TODO</h1>
<ol type="1">
<li><p>We add a non runnable app ka dependency as a jar. Jo nexus pe
upload Hota tha. And we just added that dependency in our pom, jo fir
Nexus se download Hota tha</p></li>
<li><p>What you can also check is avro schemas. Isme you don’t maintain
a pojo or a jar. You just maintain a avro file, and us avso se
automatically pojos ban jate hai once the build is complete.</p>
<p>Fayda of this is, you get backward compatibility. Ek ms ne 2 fields
add kiye, ek ko chahiye ek ko nahi chahiye to it works.</p>
<p>Also you can maintain versions of these avros and switch seamlessly
between them. And also see online ki 21 v me konse fields the and 22 me
konse and so on</p>
<p>Basically, what if a non tech person is maintaining the pojos. He
just has to mention the new field, that’s it</p></li>
<li><p>kafka with microservice</p></li>
<li><p>redis with microservice</p></li>
<li><p>Deploy docker image for free in render</p></li>
</ol>
        </div>
      </div>
    </div>
    
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="https://maxcdn.bootstrapcdn.com/js/ie10-viewport-bug-workaround.js"></script>
    <script>
        //document.getElementById('sidebar').getElementsByTagName('ul')[0].className += "nav nav-sidebar";
        
        /* ajust the height when click the toc
           the code is from https://github.com/twbs/bootstrap/issues/1768
        */
        var shiftWindow = function() { scrollBy(0, -50) };
        window.addEventListener("hashchange", shiftWindow);
        function load() { if (window.location.hash) shiftWindow(); }
        
        /*add Bootstrap styles to tables*/
        var tables = document.getElementsByTagName("table");
        for(var i = 0; i < tables.length; ++i){
            tables[i].className += "table table-bordered table-hover";
        }
    </script>
  </body>
</html>
